<mvc:View
    controllerName="vcp.vcplannerdashboard.controller.View1"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:m="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:uxap="sap.uxap"
    xmlns:card="sap.ui.integration.widgets"
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:viz.data="sap.viz.ui5.data"
    xmlns:table="sap.ui.table"
    xmlns:vizFeeding="sap.viz.ui5.controls.common.feeds"
    xmlns:html="http://www.w3.org/1999/xhtml"
    height="100%">

    <uxap:ObjectPageLayout
        id="ObjectPageLayout"
        showTitleInHeaderContent="true"
        useIconTabBar="false"
        alwaysShowContentHeader="true"
        showAnchorBar="true"
        enableLazyLoading="false"
        upperCaseAnchorBar="false">

        <!-- ========================================================= -->
        <!-- === HEADER ============================================== -->
        <!-- ========================================================= -->
        <uxap:headerTitle>
            <uxap:ObjectPageDynamicHeaderTitle class="header">
                <uxap:expandedHeading>
                    <m:VBox width="100%">
                        <m:HBox class="header-top" alignItems="Center" justifyContent="SpaceBetween" width="100%">
                            <!-- === Logo and Title === -->
                            <m:HBox class="logo-section" alignItems="Center">
                                <m:Image class="logo" id="idHeaderImage" />
                                <m:VBox class="title-section">
                                    <m:Title text="VC Planner Dashboard" level="H1" />
                                    <m:Text text="Sales &amp; Operations Planning for Configurable Products" />
                                </m:VBox>

                                <!-- === Variant Management === -->
                                <m:VariantManagement
                                    id="idMatListVPD"
                                    select="handleSelectPress"
                                    save="onCreate"
                                    manage="onManage"
                                    supportFavorites="false"
                                    showFooter="true"
                                    popoverTitle="My Views"
                                    items="{viewDetails>/items12}"
                                    creationAllowed="true"
                                    supportPublic="true"
                                    supportApplyAutomatically="false"
                                    manageCancel="onManageCancel"
                                    cancel="onNameCancel"
                                    visible="true">
                                    <m:items>
                                        <m:VariantItem
                                            key="{viewDetails>VARIANTID}"
                                            text="{viewDetails>VARIANTNAME}"
                                            author="{viewDetails>USER}"
                                            visible="true"
                                            remove="{path:'viewDetails>REMOVE', formatter:'.formatter.formatRemove'}"
                                            sharing="{viewDetails>SCOPE}"
                                            changeable="{path:'viewDetails>CHANGE', formatter:'.formatter.formatChange'}"
                                            rename="false"
                                            enabled="{path:'viewDetails>ENABLE', formatter:'.formatter.formatEnable'}" />
                                    </m:items>
                                </m:VariantManagement>
                            </m:HBox>

                            <!-- === Filters and Buttons === -->
                            <m:HBox class="controls" alignItems="Center" justifyContent="End">
                                <m:VBox class="control-group">
                                    <m:Label text="Location" />
                                    <m:ComboBox
                                        id="LocationSelect"
                                        items="{locModel>/results1}"
                                        showSecondaryValues="true"
                                        selectionChange=".onLocationChange"
                                        placeholder="Select Location" required="true">
                                        <core:ListItem
                                            key="{locModel>DEMAND_LOC}"
                                            text="{locModel>DEMAND_DESC}"
                                            additionalText="{locModel>DEMAND_LOC}" />
                                    </m:ComboBox>
                                </m:VBox>

                                <m:VBox class="control-group">
                                    <m:Label text="Product" />
                                    <m:ComboBox
                                        id="productSelect"
                                        items="{prodModel>/results2}"
                                        showSecondaryValues="true"
                                        selectionChange=".onProductChange"
                                        placeholder="Select Product" required="true">
                                        <core:ListItem
                                            key="{prodModel>PRODUCT_ID}"
                                            text="{prodModel>PROD_DESC}"
                                            additionalText="{prodModel>PRODUCT_ID}" />
                                    </m:ComboBox>
                                </m:VBox>

                                <m:VBox>
                                    <m:Label text="" />
                                    <m:Button id="idBtnPD" press="onGetData" text="Go" type="Emphasized" />
                                </m:VBox>

                                <m:VBox>
                                    <m:Label text="" />
                                    <m:Button id="idResetPD" press="onResetData" text="Reset" />
                                </m:VBox>

                                <m:VBox>
                                    <m:Label text="" />
                                    <m:Button id="idWidget" press="onAdaptWidgets" text="Adapt Widgets" />
                                </m:VBox>
                            </m:HBox>
                        </m:HBox>
                    </m:VBox>
                </uxap:expandedHeading>
            </uxap:ObjectPageDynamicHeaderTitle>
        </uxap:headerTitle>

        <!-- ========================================================= -->
        <!-- === SECTIONS ============================================ -->
        <!-- ========================================================= -->
        <uxap:sections>

            <!-- ðŸŸ¦ Alerts Section -->
            <uxap:ObjectPageSection id="alertsPanel" title="Alerts">
                <uxap:subSections>
                    <uxap:ObjectPageSubSection>
                        <uxap:blocks>
                            <m:VBox width="100%">
                                <m:HBox class="card-container" alignItems="Start" justifyContent="SpaceBetween" wrap="Wrap">
                                    <m:VBox class="card-wrapper smallCard" width="30%">
                                        <card:Card id="MyCardId" height="400px" />
                                    </m:VBox>
                                    <m:VBox class="card-wrapper largeCard" width="69%">
                                        <card:Card id="MyCardId3" height="400px" />
                                    </m:VBox>
                                </m:HBox>

                                <m:HBox class="card-container" alignItems="Start" justifyContent="SpaceBetween" wrap="Wrap">
                                    <m:VBox class="card-wrapper" width="49%">
                                        <card:Card id="MyCardId1" height="400px" width="100%" />
                                    </m:VBox>
                                    <m:VBox class="card-wrapper" width="50%">
                                        <card:Card id="MyCardId4" height="400px" width="100%" />
                                    </m:VBox>
                                </m:HBox>
                            </m:VBox>
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- ðŸŸ© Forecast Accuracy Section -->
            <uxap:ObjectPageSection id="lagsPanel" title="Forecast Accuracy">
                <uxap:subSections>
                    <uxap:ObjectPageSubSection>
                        <uxap:blocks>
                           <m:VBox width="100%">

                        <!-- ROW 1: Assembly + Option Mix -->
                        <m:HBox class="sapUiMediumMarginBottom"
                              alignItems="Start"
                              justifyContent="SpaceBetween"
                              wrap="Wrap">
                            <m:items>

                                <!-- ASSEMBLY LAG -->
                                <m:VBox width="99%" class="lag-box lag-assembly sapUiSmallMarginEnd sapUiSmallMarginBottom">
                                    <m:Title text="Forecast Accuracy" level="H3" class="sapUiSmallMarginBottom" />
                                    <m:HBox alignItems="Center" justifyContent="Start" class="sapUiSmallMarginBottom">
                                        <m:items>
                                            <m:VBox>
                                                <m:Label id="idFac" text="Manufacturing Location" required="true"/>
                                                <m:ComboBox id="cbFactory"
                                                          items="{location>/Location}"
                                                          showSecondaryValues="true"
                                                          selectionChange=".onFacLocChange"
                                                          placeholder="Select Manufacturing Location">
                                                    <core:ListItem key="{location>FACTORY_LOC}"
                                                                   text="{location>LOCATION_DESC}"
                                                                   additionalText="{location>FACTORY_LOC}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label id="idAss" text="Start Month" required="true"/>
                                                <m:ComboBox id="cbStartMonth"
                                                          items="{calendarStart>/MONTHDATA}"
                                                          showSecondaryValues="true"
                                                          selectionChange=".onAssemblyChange"
                                                          placeholder="Select Start Month">
                                                    <core:ListItem key="{calendarStart>PERIODDESC}" text="{calendarStart>PERIODDESC}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label id="idMonth" text="End Month" required="true"/>
                                                <m:ComboBox id="cbEndMonth"
                                                          items="{calendarEnd>/MONTHDATAEND}"
                                                          showSecondaryValues="true"
                                                          selectionChange=".onGo"
                                                          placeholder="Select End Month">
                                                    <core:ListItem key="{calendarEnd>PERIODDESC}" text="{calendarEnd>PERIODDESC}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                        </m:items>
                                    </m:HBox>

                                     <m:VBox id="pivotPageLag">
                <m:OverflowToolbar id="idPivotToolBarLag" height="12%" visible="{= ${oGModel>/showPivot} }">
                <m:Label text="Lags Type:" design="Bold"></m:Label>
                    <m:ComboBox id="idTypeBox" selectedKey="Assembly" selectionChange="onChnageType">
                        <core:Item key="Assembly" text="Assembly" />
                        <core:Item key="Product" text="Product Demand" />
                        <core:Item key="Restriction" text="Restriction" />
                        <core:Item key="Characteristic" text="Characteristic" />
                    </m:ComboBox>
                    <m:CheckBox id="idFilterCheck" selected="true" text="Show Filter" select="onFilter"></m:CheckBox>
                    <m:Button text="Key Figure" id="idkeyFig" press="onPressKey"></m:Button>
                    <m:ToolbarSpacer />
                    <m:RadioButtonGroup id="idMapTypeGroup" columns="3" selectedIndex="0" select="onSelectMapType">
                        <m:RadioButton id="idMapBox" text="MAPE" />
                        <m:RadioButton id="idLagQtyBox" text="Lag Quantity" />
                        <m:RadioButton id="idMapQtyBox" text="MAPE Quantity" />
                    </m:RadioButtonGroup>
                </m:OverflowToolbar>

                <table:Table id="myTableLag" visible="{= !${oGModel>/showPivot} }" width="100%">
                </table:Table>
                <html:div id="mainDivLag" class = "mainDivClass"/>
            </m:VBox>
                                </m:VBox>

                                <!-- OPTION MIX LAG -->
                                <!-- <m:VBox width="49%" class="lag-box lag-option sapUiSmallMarginBottom">
                                    <m:Title text="Option Mix Lag Analysis" level="H3" class="sapUiSmallMarginBottom" />
                                    <m:HBox alignItems="Center" justifyContent="Start" class="sapUiSmallMarginBottom">
                                        <m:items>
                                            <m:VBox>
                                                <m:Label text="Factory Location" required="true"/>
                                                <m:ComboBox id="cbFactoryPL"
                                                          items="{filters>/Factory_loc}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onOptFacChange"
                                                          placeholder="Select Factory Location">
                                                    <core:ListItem key="{filters>FACTORY_LOC}"
                                                                   text="{filters>LOCATION_DESC}"
                                                                   additionalText="{filters>FACTORY_LOC}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label text="Month" required="true"/>
                                                <m:ComboBox id="cbMonthPL"
                                                          items="{calendarOpt>/Month}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onOptMonthChange"
                                                          placeholder="Select Month">
                                                    <core:ListItem key="{calendarOpt>MONTH}" text="{calendarOpt>MONTH}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label text="Char." required="true"/>
                                                <m:ComboBox id="cbCharPL"
                                                          items="{characteristic>/CHARA_NUM}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onOptCharChange"
                                                          placeholder="Select Characteristic">
                                                    <core:ListItem key="{characteristic>CHAR_NUM}" text="{characteristic>CHAR_NUM}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label text="Char. Value" required="true"/>
                                                <m:ComboBox id="cbCharValPL"
                                                          items="{characteristicValue>/CHARA_VALUE}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onOptMixGo"
                                                          placeholder="Select Char. Value">
                                                    <core:ListItem key="{characteristicValue>CHAR_VALUE}" text="{characteristicValue>CHAR_VALUE}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                        </m:items>
                                    </m:HBox>

                                    <viz:VizFrame id="idOptMixWF"
                                                  uiConfig="{applicationSet:'fiori'}"
                                                  vizType="waterfall"
                                                  height="400px"
                                                  width="100%">
                                        <viz:dataset>
                                            <viz.data:FlattenedDataset data="{waterfallModelOpt>/WaterfallDataOpt}">
                                                <viz.data:dimensions>
                                                    <viz.data:DimensionDefinition name="Lag Month" value="{waterfallModelOpt>LAG_MONTH}" />
                                                </viz.data:dimensions>
                                                <viz.data:measures>
                                                    <viz.data:MeasureDefinition name="Mape Qty" value="{waterfallModelOpt>MAPE}" />
                                                </viz.data:measures>
                                            </viz.data:FlattenedDataset>
                                        </viz:dataset>
                                        <viz:feeds>
                                            <vizFeeding:FeedItem uid="categoryAxis" type="Dimension" values="Lag Month" />
                                            <vizFeeding:FeedItem uid="valueAxis" type="Measure" values="Mape Qty" />
                                        </viz:feeds>
                                    </viz:VizFrame>
                                </m:VBox> -->

                            </m:items>
                        </m:HBox>

                        <!-- ROW 2: Restriction + Product Demand -->
                        <!-- <m:HBox alignItems="Start" justifyContent="SpaceBetween" wrap="Wrap">
                            <m:items> -->

                                <!-- RESTRICTION LAG -->
                                <!-- <m:VBox width="49%" class="lag-box lag-restriction sapUiSmallMarginEnd sapUiSmallMarginBottom">
                                    <m:Title text="Restriction Lag Analysis" level="H3" class="sapUiSmallMarginBottom" />
                                    <m:HBox alignItems="Center" justifyContent="Start" class="sapUiSmallMarginBottom">
                                        <m:items>
                                            <m:VBox>
                                                <m:Label text="Factory Location" required="true"/>
                                                <m:ComboBox id="cbFactoryPR"
                                                          items="{filters>/Factory_loc}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onRtrLocChange"
                                                          placeholder="Select Factory Location">
                                                    <core:ListItem key="{filters>FACTORY_LOC}"
                                                                   text="{filters>LOCATION_DESC}"
                                                                   additionalText="{filters>FACTORY_LOC}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label text="Month" required="true"/>
                                                <m:ComboBox id="cbMonthPR"
                                                          items="{calendarRtr>/MonthRtr}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onRtrMonthChange"
                                                          placeholder="Select Month">
                                                    <core:ListItem key="{calendarRtr>MONTH}" text="{calendarRtr>MONTH}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label text="Line" required="true"/>
                                                <m:ComboBox id="cbLinePR"
                                                          items="{LINEIDRT>/LINEIDRTR}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onRtrLineChange"
                                                          placeholder="Select Line">
                                                    <core:ListItem key="{LINEIDRT>LINE_ID}" text="{LINEIDRT>LINE_ID}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label text="Restriction" required="true"/>
                                                <m:ComboBox id="cbRstrPR"
                                                          items="{RTRID>/RTR_ID}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onRtrGo"
                                                          placeholder="Select Restriction">
                                                    <core:ListItem key="{RTRID>RESTRICTION}" text="{RTRID>RESTRICTION}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                        </m:items>
                                    </m:HBox>

                                    <viz:VizFrame id="idRTRWF"
                                                  uiConfig="{applicationSet:'fiori'}"
                                                  vizType="waterfall"
                                                  height="400px"
                                                  width="100%">
                                        <viz:dataset>
                                            <viz.data:FlattenedDataset data="{rtrLagModel>/WaterfallDataRTR}">
                                                <viz.data:dimensions>
                                                    <viz.data:DimensionDefinition name="Lag Month" value="{rtrLagModel>LAG_MONTH}" />
                                                </viz.data:dimensions>
                                                <viz.data:measures>
                                                    <viz.data:MeasureDefinition name="Mape Qty" value="{rtrLagModel>MAPE}" />
                                                </viz.data:measures>
                                            </viz.data:FlattenedDataset>
                                        </viz:dataset>
                                        <viz:feeds>
                                            <vizFeeding:FeedItem uid="categoryAxis" type="Dimension" values="Lag Month" />
                                            <vizFeeding:FeedItem uid="valueAxis" type="Measure" values="Mape Qty" />
                                        </viz:feeds>
                                    </viz:VizFrame>
                                </m:VBox> -->

                                <!-- PRODUCT DEMAND LAG -->
                                <!-- <m:VBox width="49%" class="lag-box lag-demand sapUiSmallMarginBottom">
                                    <m:Title text="Product Demand Lag Analysis" level="H3" class="sapUiSmallMarginBottom" />
                                    <m:HBox alignItems="Center" justifyContent="Start" class="sapUiSmallMarginBottom">
                                        <m:items>
                                            <m:VBox>
                                                <m:Label text="Factory Location" required="true"/>
                                                <m:ComboBox id="cbFactoryDL"
                                                          items="{filters>/Factory_loc}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onPrdDmdLocChange"
                                                          placeholder="Select Factory Location">
                                                    <core:ListItem key="{filters>FACTORY_LOC}"
                                                                   text="{filters>LOCATION_DESC}"
                                                                   additionalText="{filters>FACTORY_LOC}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                            <m:VBox>
                                                <m:Label text="Month" required="true"/>
                                                <m:ComboBox id="cbMonthDL"
                                                          items="{calendarPrdDmd>/MonthPrd}"
                                                          showSecondaryValues="true"
                                                          selectionChange="onPrdDmdGo"
                                                          placeholder="Select Month">
                                                    <core:ListItem key="{calendarPrdDmd>MONTH}" text="{calendarPrdDmd>MONTH}" />
                                                </m:ComboBox>
                                            </m:VBox>
                                        </m:items>
                                    </m:HBox>

                                    <viz:VizFrame id="idPRDDMDWF"
                                                  uiConfig="{applicationSet:'fiori'}"
                                                  vizType="waterfall"
                                                  height="400px"
                                                  width="100%">
                                        <viz:dataset>
                                            <viz.data:FlattenedDataset data="{prddmdLagModel>/WaterfallDataPrdDmd}">
                                                <viz.data:dimensions>
                                                    <viz.data:DimensionDefinition name="Lag Month" value="{prddmdLagModel>LAG_MONTH}" />
                                                </viz.data:dimensions>
                                                <viz.data:measures>
                                                    <viz.data:MeasureDefinition name="Mape Qty" value="{prddmdLagModel>MAPE}" />
                                                </viz.data:measures>
                                            </viz.data:FlattenedDataset>
                                        </viz:dataset>
                                        <viz:feeds>
                                            <vizFeeding:FeedItem uid="categoryAxis" type="Dimension" values="Lag Month" />
                                            <vizFeeding:FeedItem uid="valueAxis" type="Measure" values="Mape Qty" />
                                        </viz:feeds>
                                    </viz:VizFrame>
                                </m:VBox> -->

                            <!-- </m:items>
                        </m:HBox> -->

                    </m:VBox>
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- ðŸŸ¨ WoW Variance Section -->
            <uxap:ObjectPageSection id="idRow4" title="WoW Variance">
                <uxap:subSections>
                    <uxap:ObjectPageSubSection>
                        <uxap:blocks>
                            <m:HBox
                                id="idRow5"
                                class="card-container wow-panel sapUiMediumMarginBottom"
                                alignItems="Start"
                                justifyContent="SpaceBetween"
                                wrap="Wrap">
                                <!-- <m:VBox class="card-wrapper" width="25%">
                                    <card:Card id="MyCardId2" height="500px" width="100%" />
                                </m:VBox> -->

                                <m:VBox class="card-wrapper" width="99%">
                                    <m:Title text="WoW Variance Analysis" level="H3" class="sapUiSmallMarginBottom" />
                                    <m:HBox alignItems="Center" justifyContent="Start" class="sapUiSmallMarginBottom">
                                    <m:items>
                                        <m:VBox>
                                            <m:Label text="Type" required="true" />
                                            <m:ComboBox id="idWOW"
                                                      items="{wowModel>/options}"
                                                      selectedKey="{wowModel>/selectedKey}"
                                                      showSecondaryValues="true"
                                                      placeholder="Select Type"
                                                      selectionChange=".onTypeChange">
                                                <core:ListItem key="{wowModel>key}" text="{wowModel>text}" />
                                            </m:ComboBox>
                                        </m:VBox>
                                        <m:VBox>
                                            <m:Label text="Variance" required="true"/>
                                            <m:ComboBox id="idVariance"
                                                      items="{wowModelVariance>/Variance}"
                                                      selectedKey="{wowModelVariance>/selectedKey}"
                                                      showSecondaryValues="true"
                                                      placeholder="Select Variance"
                                                      selectionChange=".onVarianceChange">
                                                <core:ListItem key="{wowModelVariance>key}" text="{wowModelVariance>text}" />
                                            </m:ComboBox>
                                        </m:VBox>
                                    </m:items>
                                </m:HBox>
                                    <viz:VizFrame
                                        id="MyCardIdFore"
                                        uiConfig="{applicationSet:'fiori'}"
                                        vizType="column"
                                        height="400px"
                                        width="100%">
                                        <viz:dataset>
                                            <viz.data:FlattenedDataset data="{wowVariance>/wowVarianceType}">
                                                <viz.data:dimensions>
                                                    <viz.data:DimensionDefinition name="Week Desc" value="{wowVariance>THIS_WEEK_DATE}" />
                                                </viz.data:dimensions>
                                                <viz.data:measures>
                                                    <viz.data:MeasureDefinition name="Percentage Variance" value="{wowVariance>PERCENT_DIFF_WOW}" />
                                                </viz.data:measures>
                                            </viz.data:FlattenedDataset>
                                        </viz:dataset>
                                        <viz:feeds>
                                            <vizFeeding:FeedItem uid="categoryAxis" type="Dimension" values="Week Desc" />
                                            <vizFeeding:FeedItem uid="valueAxis" type="Measure" values="Percentage Variance" />
                                        </viz:feeds>
                                    </viz:VizFrame>
                                </m:VBox>
                            </m:HBox>
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

        </uxap:sections>
    </uxap:ObjectPageLayout>

    <!-- Floating Quick Help Button -->
    <m:Button
        id="quickHelpRibbon"
        text="Quick Help"
        icon="sap-icon://sys-help"
        press="onOpenQuickHelp"
        class="quickHelpRibbon"
         />
</mvc:View>
